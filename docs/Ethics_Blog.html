<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="In this blog entry, I examine a major ethical dilemma that emerged in 2016 when investigative journalists from The Guardian uncovered a serious breach of data ethics involving the political consulting firm Cambridge Analytica. “The company had harvested personal data from more than 50 million Facebook user profiles without proper consent” (Wong, 2018). Cambridge Analytica acquired this data by paying a few thousand Facebook users to complete a personality test through an app that claimed to collect information for academic research.As The New York Times reported, the app, titled “This Is Your Digital Life”, was created by Aleksandr Kogan, a Cambridge University researcher who also operated a private firm called Global Science Research (GSR). Cambridge Analytica contracted GSR to design and distribute this app, which covertly harvested not only the data of test participants but also that of their Facebook friends, exponentially expanding the dataset (Confessore, 2018).The collected information was used to construct psychological profiles and predictive models that were later sold to political campaigns to enable micro-targeted advertising during the 2016 U.S. presidential election. Facebook eventually discovered the misuse but failed to adequately inform users or prevent the data from being used for political purposes (Confessore, 2018).The major ethical dilemma at play here is: Can data, collected under one pretence, be used or repurposed for an entirely different purpose? In this case, it was used for political influence without informed consent. Here, information gathered under the guise of academic research was used for political manipulation without informed consent. The dilemma exposes deeper concerns about individual autonomy, privacy, and the integrity of democratic processes in an era dominated by large-scale data analytics.Refrence: Article 1: The Guardian | Article 2: The New York TimesAuthors: Julia Wong (Guardian), Nicholas Confessore (NYT)">

<title>An Analyisis of Data Ethics – Thomas Price</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-d1b12f2568ecbe55642fee6aa00bd082.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="style.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Thomas Price</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-project-portfolio" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Project Portfolio</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-project-portfolio">    
        <li>
    <a class="dropdown-item" href="./tidygas.html">
 <span class="dropdown-text">Analysis of US Gas Prices</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./billboard_t100.html">
 <span class="dropdown-text">Visualizing the Billboard Top 100</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Proj2.html">
 <span class="dropdown-text">Analysis of Obama’s Tweets</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./simulation.html">
 <span class="dropdown-text">Permutation Test:GDP and Life Expectancy</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Ethics_Blog.html">
 <span class="dropdown-text">Analysis of Data Ethics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Proj5.html">
 <span class="dropdown-text">SQL Analysis of Racial Disparities in Police Searches</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Thesis.html">
 <span class="dropdown-text">Using R in my Thesis Prospectus</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Presentation.html">
 <span class="dropdown-text">Examining Twitter Usage Across Presidential Administrations</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<div class="quarto-about-jolla">
  <img src="images/Zuck.jpeg" class="about-image
  rounded " style="width: 25em;">
 <header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">An Analyisis of Data Ethics</h1>
<p class="subtitle lead">Analyzing the Cambridge Analytica and Facebook Data Breach</p>
</div>
<div>
  <div class="description">
    <p>In this blog entry, I examine a major ethical dilemma that emerged in 2016 when investigative journalists from The Guardian uncovered a serious breach of data ethics involving the political consulting firm Cambridge Analytica. “The company had harvested personal data from more than 50 million Facebook user profiles without proper consent” (Wong, 2018). Cambridge Analytica acquired this data by paying a few thousand Facebook users to complete a personality test through an app that claimed to collect information for academic research.</p>
    <p>As The New York Times reported, the app, titled “This Is Your Digital Life”, was created by Aleksandr Kogan, a Cambridge University researcher who also operated a private firm called Global Science Research (GSR). Cambridge Analytica contracted GSR to design and distribute this app, which covertly harvested not only the data of test participants but also that of their Facebook friends, exponentially expanding the dataset (Confessore, 2018).</p>
    <p>The collected information was used to construct psychological profiles and predictive models that were later sold to political campaigns to enable micro-targeted advertising during the 2016 U.S. presidential election. Facebook eventually discovered the misuse but failed to adequately inform users or prevent the data from being used for political purposes (Confessore, 2018).</p>
    <p>The major ethical dilemma at play here is: Can data, collected under one pretence, be used or repurposed for an entirely different purpose? In this case, it was used for political influence without informed consent. Here, information gathered under the guise of academic research was used for political manipulation without informed consent. The dilemma exposes deeper concerns about individual autonomy, privacy, and the integrity of democratic processes in an era dominated by large-scale data analytics.</p>
    <p>Refrence: <a href="https://www.theguardian.com/technology/2019/mar/17/the-cambridge-analytica-scandal-changed-the-world-but-it-didnt-change-facebook">Article 1: The Guardian</a> | <a href="https://www.nytimes.com/2018/04/04/us/politics/cambridge-analytica-scandal-fallout.html">Article 2: The New York Times</a></p>
    <p>Authors: Julia Wong (Guardian), Nicholas Confessore (NYT)</p>
  </div>
</div>
<div class="quarto-title-meta">
  </div>
</header><main class="content" id="quarto-document-content">
<p>Considerations:</p>
<ol type="1">
<li>What is the permission structure for using the data? Was it followed?</li>
</ol>
<p>From Wong’s Guardian Article, we learn that the permission structure claimed to be “academic research” for the users who consented to participate in the personality test. I compared the following information with my own research of Facebook’s permissions structure. According to Wong, Facebook’s privacy policy did allow researchers to collect not only direct user data, but also that of friends (Wong 2018). Facebook does confirm this, in both court hearings and through legal documentation I was able to find. However, because friends did not explicitly give permission, this permission structure was compromised. Confessore builds on this, adding that Facebook’s own policy required that apps/tests ask for “a clear privacy policy and user authorization” and that Facebook has the ability to revoke data access when misuse is detected, but FB did not sufficiently alert impacted users (Confessore, 2018). Thus, although a formal permission structure existed (Facebook’s platform rules, app disclosure), it was not followed in practice by the parties involved.</p>
<ol start="2" type="1">
<li>What was the consent for recruiting participants?</li>
</ol>
<p>According to the Wong through the Guardian, only a few thousand users who ended up installing the personality test app knowingly supplied their data under the pretense of “academic research”. None of their FB friends were asked directly for consent. From Confessore’s article, we get the picture that Facebook’s terms required “informed consent” for data usage, yet the app’s true purpose (political targeting) was not disclosed (Confessore, 2018). Thus, the consent given was incomplete: it was partially informed and did not cover the large network of friends whose data was used.</p>
<ol start="3" type="1">
<li>Is the data being used in unintended ways?</li>
</ol>
<p>Both articles make it clear that the data was being used in dishonest and manipulative ways. Wong details how Cambridge Analytica created psychographic models by transforming Facebook “likes” and friend networks into political persuasion mechanisms that could be weaponized by campaign strategists (Wong, 2018). Researchers inferred user traits using the OCEAN model (Openness, Conscientiousness, Extraversion, Agreeableness, and Neuroticism), which allowed them to predict how individuals might respond to targeted political messages. The company combined this with network analysis, exploiting friend connections and engagement metadata to build a comprehensive psychological map of the electorate. The New York Times emphasizes that Facebook’s algorithmic infrastructure enabled this misuse by allowing developers to collect not only users’ data but also that of their entire social networks, creating a massive dataset that could be repurposed for political manipulation (Confessore, 2018). This repurposing of data, gathered under the pretense of academic research, violated informed consent and exploited personal information for profit and political gain. The harm extended beyond individual privacy breaches; it undermined public trust, compromised user autonomy, and threatened the integrity of democratic processes. Facebook’s own rules required that data be used only for the purpose disclosed to users, yet in this case, that standard was clearly ignored.</p>
<ol start="4" type="1">
<li>Who was being measured?</li>
</ol>
<p>The individuals actually measured in this case were the relatively small group of Facebook users, about 270,000 people who installed Aleksandr Kogan’s personality quiz app “This Is Your Digital Life.” “These users consented to share their personal data for what they believed was academic research” (Wong, 2018). However, as The New York Times reported, the app also collected information from the users’ Facebook friends, expanding the dataset to more than 50 million profiles that had never agreed to participate (Confessore, 2018). In other words, “the people whose data was taken were not the people who had given permission” (Wong, 2018). Cambridge Analytica then attempted to generalize the personality insights drawn from this small, non-representative sample to the broader Facebook population, and, by extension, to the U.S. electorate. This extrapolation was both scientifically unsound and ethically problematic because it applied inferences from a limited dataset to millions of individuals who were never directly measured or informed.</p>
<ol start="5" type="1">
<li>Summary: Why does this matter?</li>
</ol>
<p>This case is uniquely pertinent, for it rests at the intersection of autonomy, democracy, and privacy. Those who benefited from the exploitation were data brokers, political strategists, and platform owners who exploited this breach for profit and influence (Wong, 2018). The individuals directly monitored were a small, consenting group of users who installed the quiz app. However, the harms transcended that sample. Millions of people who never consented to data collection had their personal information and “psychological traits inferred, modeled and used to shape and influence political behavior” (Confessore, 2018). As a result, both individual autonomy and democratic integrity were compromised through opaque micro-targeting and manipulation.</p>
<p>Since the scandal broke, Facebook and Cambridge Analytica have faced extensive legal and reputational fallout. Facebook claimed it removed the “This Is Your Digital Life” app in 2015 and required that all parties certify the deletion of improperly obtained data. In a statement following the exposure, Facebook vice president Paul Grewal emphasized that the company was “committed to vigorously enforcing our policies to protect people’s information” and would take any necessary steps to ensure compliance (Confessore, 2018). However, these actions came only after the misuse had already occurred, raising questions about the adequacy of Facebook’s oversight and accountability mechanisms. Ultimately, the ethical violations in this case were driven more by profit and political gain than by transparency or public good. In a world where vast quantities of personal data can be harvested and repurposed in seconds, this episode serves as a cautionary example of the urgent need for stronger governance, informed consent standards, and ethical accountability in data-driven research and technology.</p>
<p><a href="https://www.theguardian.com/technology/2019/mar/17/the-cambridge-analytica-scandal-changed-the-world-but-it-didnt-change-facebook">image source: The Guardian</a></p>
<p>Sources Cited:</p>
<p>[Wong, Julia Carrie. “The Cambridge Analytica Scandal Changed the World – but It Didn’t Change Facebook.” The Guardian, The Guardian, 18 Mar.&nbsp;2019] (www.theguardian.com/technology/2019/mar/17/the-cambridge-analytica-scandal-changed-the-world-but-it-didnt-change-facebook)</p>
<p>[Confessore, Nicholas. “Cambridge Analytica and Facebook: The Scandal and the Fallout so Far.” Nytimes.com, The New York Times, 4 Apr.&nbsp;2018,] (www.nytimes.com/2018/04/04/us/politics/cambridge-analytica-scandal-fallout.html)</p>


</main>  
</div>
 <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>